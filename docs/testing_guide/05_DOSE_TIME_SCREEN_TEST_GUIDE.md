# 복용 시간 설정 화면 테스트 가이드

> **DoseTimeScreen 테스트 및 사용법**

## 📋 개요

복용 시간 설정 화면은 복용 횟수에 따라 각 복용 시간을 설정하는 화면입니다. 시간과 분을 개별적으로 조정할 수 있으며, 여러 복용 시간을 순차적으로 설정할 수 있습니다.

## 🎯 주요 기능

- **시간/분 조정** (A/B 버튼으로 증감)
- **시간↔분 전환** (C 버튼으로 모드 전환)
- **다중 복용 시간** 설정 (복용 횟수에 따라)
- **Modern UI 스타일** 적용
- **한글 폰트** 지원
- **D버튼 조건부 재부팅** 지원 (메인화면에서 진입 시)
- **자동 디스크 할당** (일반 설정 과정)
- **데이터 저장** (dose_times.json)

## 🚀 테스트 방법

### 1. 개별 화면 테스트
```bash
# WiFi 연결 후 자동으로 복용시간선택 화면이 표시되고,
# 복용시간선택 완료 후 자동으로 시간 설정 화면이 표시됩니다
# 별도의 메뉴 선택이 필요하지 않습니다
```

### 2. 테스트 시나리오
1. **시간 설정 테스트**
   - **A/B 버튼**: 시간 또는 분 증감
   - **C 버튼**: 시간↔분 모드 전환
   - **D 버튼**: 설정 완료

2. **다중 시간 설정**
   - 복용 횟수에 따라 여러 시간 설정
   - 각 시간을 순차적으로 설정
   - 설정 완료 시 다음 화면으로 전환

3. **D버튼 진입 테스트**
   - 메인화면에서 D버튼으로 진입한 경우
   - 시간 설정 완료 후 메인화면으로 재부팅
   - 선택된 디스크 정보 자동 저장

4. **시간 형식 확인**
   - 24시간 형식으로 표시
   - 시간: 00-23, 분: 00-59
   - 범위 초과 시 자동 조정

## 🔧 화면 구성 요소

### UI 요소
- **제목**: "복용 시간 설정"
- **현재 설정 중인 시간**: "1번째 복용 시간" 등
- **시간 표시**: "HH:MM" 형식
- **모드 표시**: "시간 설정" 또는 "분 설정"
- **버튼 힌트**: "A/B: 조정, C: 전환, D: 확인"

### 시간 설정 모드
- **시간 모드**: 시간(00-23) 조정
- **분 모드**: 분(00-59) 조정
- **모드 전환**: C 버튼으로 시간↔분 전환

## 📱 화면 전환

### 설정 완료 시
- **조건**: 모든 복용 시간 설정 완료
- **대상**: 알약 로딩 화면 (`pill_loading`)
- **전달 데이터**: 설정된 복용 시간 목록
- **방법**: `_on_time_setting_complete()` 호출

### 뒤로가기
- **조건**: C 버튼으로 뒤로가기
- **대상**: 복용 횟수 설정 화면 (`dose_count`)
- **방법**: `_go_back()` 호출

## 🔧 버튼 조작

### A 버튼
- **기능**: 시간/분 감소
- **동작**: 
  - 시간 모드: 시간 1시간 감소 (00시에서 23시로 순환)
  - 분 모드: 분 1분 감소 (00분에서 59분으로 순환)

### B 버튼
- **기능**: 시간/분 증가
- **동작**: 
  - 시간 모드: 시간 1시간 증가 (23시에서 00시로 순환)
  - 분 모드: 분 1분 증가 (59분에서 00분으로 순환)

### C 버튼
- **기능**: 시간↔분 모드 전환
- **동작**: 
  - 시간 모드 → 분 모드
  - 분 모드 → 시간 모드

### D 버튼
- **기능**: 설정 완료
- **동작**: 
  - 현재 시간 설정 완료
  - 다음 복용 시간으로 이동 (있는 경우)
  - 모든 시간 설정 완료 시 다음 화면으로 이동

## ⏰ 시간 설정 로직

### 설정 과정
1. **복용 횟수 확인**: 이전 화면에서 전달받은 횟수
2. **시간 순차 설정**: 각 복용 시간을 순차적으로 설정
3. **시간/분 조정**: A/B 버튼으로 값 조정
4. **모드 전환**: C 버튼으로 시간↔분 전환
5. **완료**: D 버튼으로 설정 완료

### 시간 검증
- **시간 범위**: 00:00 ~ 23:59
- **순환 처리**: 범위 초과 시 반대편으로 순환
- **중복 검사**: 동일한 시간 설정 방지

### 데이터 저장
- **시간 목록**: 설정된 모든 복용 시간 저장
- **다음 화면 전달**: 알약 로딩 화면에 시간 정보 전달
- **스케줄링**: 복용 시간에 따른 알림 스케줄 생성


## 📊 성능 최적화

### 메모리 관리
- **시간 배열**: 복용 횟수만큼만 메모리 할당
- **UI 요소**: 최소한의 요소만 생성
- **가비지 컬렉션**: 화면 전환 시 메모리 정리

### 사용자 경험
- **직관적 조작**: 명확한 버튼 기능
- **시각적 피드백**: 현재 모드 명확히 표시
- **빠른 응답**: 즉시 반응하는 UI

## 🔗 관련 파일

- **`screens/dose_time_screen.py`**: 복용 시간 설정 화면 구현
- **`screens/dose_count_screen.py`**: 복용 횟수 설정 화면 (이전 단계)
- **`screens/pill_loading_screen.py`**: 알약 로딩 화면 (다음 단계)
- **`main.py`**: 테스트 시스템
- **`screen_manager.py`**: 화면 전환 관리

## 📝 개발 노트

### 최근 변경사항
- **Modern UI**: 일관된 디자인 적용
- **한글 폰트**: Noto Sans KR 사용
- **모드 전환**: 직관적인 시간↔분 전환

### 향후 개선 계획
- **프리셋 시간**: 일반적인 복용 시간 프리셋
- **시간 복사**: 이전 시간을 다음 시간에 복사
- **설명 텍스트**: 각 복용 시간에 대한 설명
