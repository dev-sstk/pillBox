# 알약 로딩 화면 테스트 가이드

> **PillLoadingScreen 테스트 및 사용법**

## 📋 개요

알약 로딩 화면은 알약을 디스크에 충전하는 화면입니다. 여러 디스크의 상태를 관리하고, 알약 충전 과정을 시각적으로 보여주며, 충전 완료 후 시스템을 준비 상태로 만듭니다.

## 🎯 주요 기능

- **다중 디스크 관리** (여러 알약 디스크 상태 표시)
- **알약 충전 과정** 시각화
- **디스크 선택** 및 충전 제어
- **충전 진행률** 표시
- **Modern UI 스타일** 적용
- **모터 제어** (28BYJ-48 스테퍼 모터)
- **디스크 상태 저장** (disk_states.json)
- **자동 할당 디스크** 관리
- **설정 완료 처리** (boot_target.json)

## 🚀 테스트 방법

### 1. 개별 화면 테스트
```bash
# 시간 설정 완료 후 자동으로 알약 충전 화면이 표시됩니다
# 별도의 메뉴 선택이 필요하지 않습니다
```

### 2. 테스트 시나리오
1. **디스크 선택 테스트**
   - **A/B 버튼**: 디스크 목록에서 위/아래 이동
   - **D 버튼**: 선택한 디스크 충전 시작
   - **C 버튼**: 뒤로가기

2. **충전 과정 확인**
   - 충전 시작 시 진행률 표시
   - 디스크별 충전 상태 업데이트
   - 충전 완료 시 완료 표시

3. **시스템 준비**
   - 모든 디스크 충전 완료 후 시스템 준비
   - 다음 단계로 진행 가능

4. **모터 제어 테스트**
   - 디스크 회전 방향 확인 (반시계방향)
   - 모터 제어 중 파일 작업 제거
   - 충전 완료 후 메인화면으로 전환

## 🔧 화면 구성 요소

### UI 요소
- **제목**: "알약 로딩"
- **디스크 목록**: 각 디스크의 상태 표시
- **충전 진행률**: 현재 충전 중인 디스크의 진행률
- **버튼 힌트**: "A/B: 디스크 선택, D: 충전 시작, C: 뒤로가기"

### 디스크 상태
- **빈 디스크**: 충전 필요
- **충전 중**: 진행률 표시
- **충전 완료**: 완료 표시
- **오류**: 오류 상태 표시

## 📱 화면 전환

### 충전 완료 시
- **조건**: 모든 디스크 충전 완료
- **대상**: 메인 화면 (`main`) 또는 설정 완료
- **방법**: `_on_loading_complete()` 호출

### 뒤로가기
- **조건**: C 버튼으로 뒤로가기
- **대상**: 복용 시간 설정 화면 (`dose_time`)
- **방법**: `_go_back()` 호출

## 🔧 버튼 조작

### A 버튼
- **기능**: 디스크 목록에서 위로 이동
- **동작**: 이전 디스크 선택

### B 버튼
- **기능**: 디스크 목록에서 아래로 이동
- **동작**: 다음 디스크 선택

### C 버튼
- **기능**: 뒤로가기
- **동작**: 이전 화면으로 돌아가기

### D 버튼
- **기능**: 충전 시작
- **동작**: 선택한 디스크에 알약 충전 시작

## 💊 알약 충전 로직

### 충전 과정
1. **디스크 선택**: A/B 버튼으로 디스크 선택
2. **충전 시작**: D 버튼으로 충전 시작
3. **진행률 표시**: 충전 진행률 실시간 업데이트
4. **완료 확인**: 충전 완료 시 상태 업데이트

### 디스크 관리
- **디스크 상태**: 빈 상태, 충전 중, 완료, 오류
- **진행률**: 0% ~ 100% 표시
- **충전 시간**: 디스크별 충전 시간 관리

### 모터 제어
- **스테퍼 모터**: 디스크 회전 제어
- **정밀 제어**: 알약 정확한 위치에 배치
- **안전 장치**: 과부하 방지


## 📊 성능 최적화

### 메모리 관리
- **디스크 상태**: 효율적인 상태 관리
- **UI 요소**: 최소한의 요소만 생성
- **가비지 컬렉션**: 충전 완료 후 메모리 정리

### 모터 제어
- **정밀 제어**: 정확한 위치 제어
- **에너지 효율**: 최적의 모터 동작
- **안전성**: 과부하 및 오류 방지

## 🔗 관련 파일

- **`screens/pill_loading_screen.py`**: 알약 로딩 화면 구현
- **`motor_control.py`**: 스테퍼 모터 제어
- **`screens/dose_time_screen.py`**: 복용 시간 설정 화면 (이전 단계)
- **`main.py`**: 테스트 시스템
- **`screen_manager.py`**: 화면 전환 관리

## 📝 개발 노트

### 최근 변경사항
- **Modern UI**: 일관된 디자인 적용
- **한글 폰트**: Noto Sans KR 사용
- **메모리 최적화**: 효율적인 리소스 관리

### 향후 개선 계획
- **자동 충전**: 모든 디스크 자동 충전
- **충전 예약**: 특정 시간에 충전 예약
- **알약 종류**: 다양한 알약 종류 지원
