# 74HC595D 스테퍼모터 테스트 가이드

> **⚠️ 중요**: 이 가이드는 작업자가 단계별로 따라할 수 있도록 작성되었습니다. 각 단계를 순서대로 진행하세요.

## 📋 목차
1. [준비사항 확인](#준비사항-확인)
2. [하드웨어 연결](#하드웨어-연결)
3. [테스트 파일 업로드](#테스트-파일-업로드)
4. [테스트 실행](#테스트-실행)
5. [문제 해결](#문제-해결)
6. [완료 체크리스트](#완료-체크리스트)

---

## 🎯 준비사항 확인

### ✅ 필요한 하드웨어
- [ ] ESP32-C6 기반 PCB
- [ ] 74HC595D 시프트 레지스터 연결된 PCB
- [ ] ULN2003 스테퍼모터 드라이버
- [ ] 28BYJ-48 스테퍼모터 4개
- [ ] USB 케이블
- [ ] 컴퓨터 (Windows 10/11)

### ✅ 필요한 소프트웨어
- [ ] Python 3.8 이상
- [ ] esptool, ampy 설치 완료
- [ ] PuTTY 설치 완료
- [ ] 최신 펌웨어 업로드 완료

### 📦 테스트 대상
- **74HC595D** 시프트 레지스터 (2개) - 직렬 입력을 병렬 출력으로 변환
- **ULN2003** 스테퍼모터 드라이버
- **28BYJ-48** 스테퍼모터 (4개)
- **74HC165D** 입력 시프트 레지스터 (리미트 스위치용)
- **ESP32-C6** GPIO 인터페이스

### 🔄 모터 제어 방식
- **모터 0**: 74HC595D #1의 Q0~Q3 (하위 4비트)
- **모터 1**: 74HC595D #1의 Q4~Q7 (상위 4비트)
- **모터 2**: 74HC595D #2의 Q0~Q3 (하위 4비트)
- **모터 3**: 74HC595D #2의 Q4~Q7 (상위 4비트)

---

## 🔌 하드웨어 연결

### 74HC595D 출력 연결
```
ESP32-C6          74HC595D #1
GPIO2 (DI)     →  DS (Data Input)
GPIO3 (SH_CP)  →  SH_CP (Shift Clock)
GPIO15 (ST_CP) →  ST_CP (Storage Clock)
3.3V           →  VCC
GND            →  GND

74HC595D #1    →  ULN2003 #1
Q0             →  IN1 (모터 0 - A)
Q1             →  IN2 (모터 0 - B)
Q2             →  IN3 (모터 0 - C)
Q3             →  IN4 (모터 0 - D)
Q4             →  IN1 (모터 1 - A)
Q5             →  IN2 (모터 1 - B)
Q6             →  IN3 (모터 1 - C)
Q7             →  IN4 (모터 1 - D)

74HC595D #2    →  ULN2003 #2
Q0             →  IN1 (모터 2 - A)
Q1             →  IN2 (모터 2 - B)
Q2             →  IN3 (모터 2 - C)
Q3             →  IN4 (모터 2 - D)
Q4             →  IN1 (모터 3 - A)
Q5             →  IN2 (모터 3 - B)
Q6             →  IN3 (모터 3 - C)
Q7             →  IN4 (모터 3 - D)
```

### 리미트 스위치 연결 (74HC165D)
```
74HC165D       →  리미트 스위치
A4             →  모터 0 리미트 스위치
A5             →  모터 1 리미트 스위치
A6             →  모터 2 리미트 스위치
A7             →  모터 3 리미트 스위치
```

### 스테퍼모터 연결
```
ULN2003        →  28BYJ-48
OUT1           →  빨간색 (A)
OUT2           →  주황색 (B)
OUT3           →  노란색 (C)
OUT4           →  분홍색 (D)
VCC            →  5V 전원
GND            →  GND
```

---

## 📤 테스트 파일 업로드

### 1단계: 테스트 파일 업로드

1. **명령 프롬프트 열기**
   - Windows 키 + R → `cmd` 입력 → Enter

2. **프로젝트 폴더로 이동**
   ```cmd
   cd C:\Users\outrobot\OneDrive\사업\아웃로봇\신성테크\소스코드_전달\pillBox
   ```

3. **테스트 파일 업로드**
   ```cmd
   ampy -p COM3 put .\tests\test_74hc595_stepper.py
   ```

   **⚠️ 중요**: `COM3`을 실제 COM 포트 번호로 변경하세요!

---

## 🧪 테스트 실행

### 1단계: PuTTY 연결

1. **PuTTY 실행**
   - PuTTY 실행 → Load → Open

2. **연결 확인**
   - MicroPython 프롬프트(`>>>`)가 나타나면 성공

### 2단계: 테스트 실행

1. **테스트 모듈 임포트 및 실행**
   ```python
   from test_74hc595_stepper import main
   main()
   ```

2. **테스트 메뉴 확인**
   - 다음과 같은 메뉴가 나타납니다:
   ```
   74HC595D + ULN2003 스테퍼모터 테스트
   ==================================================
   
   테스트 메뉴:
   1. 모터 0 테스트
   2. 모터 1 테스트
   3. 모터 2 테스트
   4. 모터 3 테스트
   5. 모든 모터 테스트
   6. 모든 모터 동시 동작 테스트
   7. 리미트 스위치 테스트
   8. 모터 0 리미트 스위치 테스트
   9. 모터 1 리미트 스위치 테스트
   10. 모터 2 리미트 스위치 테스트
   11. 모터 3 리미트 스위치 테스트
   12. 모든 모터 무한 회전 + 리미트 스위치 테스트
   13. 모터 0 무한 회전 + 리미트 스위치 테스트
   14. 모터 1 무한 회전 + 리미트 스위치 테스트
   15. 모터 2 무한 회전 + 리미트 스위치 테스트
   16. 모터 3 무한 회전 + 리미트 스위치 테스트
   17. 시퀀스 패턴 테스트
18. 연속 회전 테스트
19. 시프트 레지스터 출력 테스트
20. 원시 입력 데이터 디버깅
21. 속도 변화 테스트
22. 대화형 속도 설정
23. 비블로킹 모터 테스트
24. 비블로킹 모터 개별 제어 테스트
25. 비블로킹 데모 테스트
26. 대화형 비블로킹 모터 제어 테스트
27. 모터 0 비블로킹 테스트
28. 모터 1 비블로킹 테스트
29. 모터 2 비블로킹 테스트
30. 모터 3 비블로킹 테스트
0. 종료

선택하세요 (0-30): 
```

### 4. 테스트 결과 예시

#### 개별 모터 테스트
```
=== 모터 0 테스트 ===
정방향 1회전...
모터 0 1회전 시작 (2048스텝)
모터 0 회전 완료
역방향 1회전...
모터 0 1회전 시작 (2048스텝)
모터 0 회전 완료
모터 0 정지
모터 0 테스트 완료
```

#### 리미트 스위치 테스트
```
=== 리미트 스위치 테스트 ===
각 모터의 리미트 스위치를 눌러보세요.
Ctrl+C로 종료
초기 상태:
Pin States:
  SW1(Menu): HIGH
  SW2(Select): HIGH
  SW3(Up): HIGH
  SW4(Down): HIGH
  LIMIT SW1: HIGH
  LIMIT SW2: HIGH
  LIMIT SW3: HIGH
  LIMIT SW4: HIGH

[   1]    12.3s - 변경 감지! SW1:H SW2:H SW3:H SW4:H LIM1:L LIM2:H LIM3:H LIM4:H
```

이 가이드를 따라 74HC595D 스테퍼모터 시스템을 정확히 테스트할 수 있습니다.
