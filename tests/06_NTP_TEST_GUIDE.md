# NTP 시간 동기화 테스트 가이드

> **⚠️ 중요**: 이 가이드는 작업자가 단계별로 따라할 수 있도록 작성되었습니다. 각 단계를 순서대로 진행하세요.

## 📋 목차
1. [준비사항 확인](#준비사항-확인)
2. [테스트 파일 업로드](#테스트-파일-업로드)
3. [테스트 실행](#테스트-실행)
4. [문제 해결](#문제-해결)
5. [완료 체크리스트](#완료-체크리스트)

---

## 🎯 준비사항 확인

### ✅ 필요한 하드웨어
- [ ] ESP32-C6 기반 PCB
- [ ] WiFi 연결 가능한 환경
- [ ] 인터넷 연결
- [ ] USB 케이블
- [ ] 컴퓨터 (Windows 10/11)

### ✅ 필요한 소프트웨어
- [ ] Python 3.8 이상
- [ ] esptool, ampy 설치 완료
- [ ] PuTTY 설치 완료
- [ ] 최신 펌웨어 업로드 완료
- [ ] WiFi 연결 완료

### ✅ 네트워크 환경
- [ ] 인터넷 연결 필수
- [ ] NTP 포트(123) 접근 가능
- [ ] 방화벽에서 NTP 트래픽 허용

### 📦 테스트 대상
- **NTP 클라이언트**: ESP32-C6 내장 NTP 기능
- **시간 동기화**: 인터넷 서버에서 정확한 시간 가져오기
- **정확도 확인**: 동기화된 시간의 정확도 검증
- **자동 동기화**: 주기적 시간 동기화 테스트

---

## 📤 테스트 파일 업로드

### 1단계: WiFi 연결 확인
NTP 테스트를 실행하기 전에 WiFi 연결이 필요합니다.

```python
# WiFi 연결 확인
import network
wlan = network.WLAN(network.STA_IF)
if wlan.isconnected():
    print("WiFi 연결됨")
else:
    print("WiFi 연결 필요")
```

### 2단계: 테스트 파일 업로드

1. **명령 프롬프트 열기**
   - Windows 키 + R → `cmd` 입력 → Enter

2. **프로젝트 폴더로 이동**
   ```cmd
   cd C:\Users\outrobot\OneDrive\사업\아웃로봇\신성테크\소스코드_전달\pillBox
   ```

3. **테스트 파일 업로드**
   ```cmd
   ampy -p COM3 put .\tests\test_ntp_sync.py
   ```

   **⚠️ 중요**: `COM3`을 실제 COM 포트 번호로 변경하세요!

---

## 🧪 테스트 실행

### 1단계: PuTTY 연결

1. **PuTTY 실행**
   - PuTTY 실행 → Load → Open

2. **연결 확인**
   - MicroPython 프롬프트(`>>>`)가 나타나면 성공

### 2단계: 테스트 실행

1. **테스트 모듈 임포트 및 실행**
   ```python
   from test_ntp_sync import main
   main()
   ```

## 테스트 메뉴

### 1. NTP 서버에서 시간 동기화
- 기본 NTP 서버에서 시간을 가져와 동기화
- 추천 서버 우선 사용
- 시간대 자동 적용

### 2. NTP 서버 응답 테스트
- 다양한 NTP 서버의 응답 시간 테스트
- 가장 빠른 서버 자동 선택
- 서버별 응답 성공/실패 확인

### 3. 시간 정확도 확인
- 현재 시간과 NTP 서버 시간 비교
- 시간 차이 계산 및 정확도 평가
- 동기화 필요성 판단

### 4. 시간대 설정
- UTC 오프셋 설정
- 주요 시간대 프리셋 제공
- 한국 시간대(UTC+9) 기본 설정

### 5. 자동 동기화 설정
- 자동 동기화 간격 설정
- 수동 동기화 실행
- 동기화 이력 확인

### 6. 현재 시간 표시
- 현재 시스템 시간 표시
- 마지막 동기화 시간 확인
- 시간대 정보 표시

## 지원하는 NTP 서버

### 글로벌 서버
- `pool.ntp.org` - 글로벌 NTP 풀
- `time.nist.gov` - 미국 NIST
- `time.windows.com` - 마이크로소프트
- `time.google.com` - 구글

### 한국 서버
- `kr.pool.ntp.org` - 한국 NTP 풀
- `time.bora.net` - KT
- `time.nuri.net` - SKT
- `time.kriss.re.kr` - 한국표준과학연구원

## 예상 결과

### 1. 성공적인 시간 동기화

```
🕐 NTP 시간 동기화 시작: pool.ntp.org
========================================
📡 NTP 서버 연결: pool.ntp.org
✓ NTP 응답 수신: pool.ntp.org
  네트워크 지연: 0.045초
✅ 시간 동기화 성공!
  서버: pool.ntp.org
  동기화 시간: 2024-01-15 14:30:25
  네트워크 지연: 0.045초
```

### 2. NTP 서버 테스트 결과

```
🌐 NTP 서버 응답 테스트
============================================================

테스트 중: pool.ntp.org
  ✅ 성공 - 2024-01-15 14:30:25 (지연: 0.045초)

테스트 중: time.google.com
  ✅ 성공 - 2024-01-15 14:30:25 (지연: 0.052초)

테스트 중: time.nist.gov
  ❌ 실패

============================================================
📊 NTP 서버 테스트 결과 요약
============================================================
성공: 2개
실패: 1개

가장 빠른 서버: pool.ntp.org (지연: 0.045초)
```

### 3. 시간 정확도 확인

```
⏰ 시간 정확도 확인
========================================
현재 시간: 2024-01-15 14:30:25
NTP 시간: 2024-01-15 14:30:25
시간 차이: 0.2초
✅ 시간이 매우 정확합니다!
```
