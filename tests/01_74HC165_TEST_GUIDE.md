# 74HC165D 시프트 레지스터 테스트 가이드

> **⚠️ 중요**: 이 가이드는 작업자가 단계별로 따라할 수 있도록 작성되었습니다. 각 단계를 순서대로 진행하세요.

## 📋 목차
1. [준비사항 확인](#준비사항-확인)
2. [하드웨어 연결](#하드웨어-연결)
3. [테스트 파일 업로드](#테스트-파일-업로드)
4. [테스트 실행](#테스트-실행)
5. [문제 해결](#문제-해결)
6. [완료 체크리스트](#완료-체크리스트)

---

## 🎯 준비사항 확인

### ✅ 필요한 하드웨어
- [ ] ESP32-C6 기반 PCB
- [ ] 74HC165D 시프트 레지스터 연결된 PCB
- [ ] USB 케이블
- [ ] 컴퓨터 (Windows 10/11)

### ✅ 필요한 소프트웨어
- [ ] Python 3.8 이상
- [ ] esptool, ampy 설치 완료
- [ ] PuTTY 설치 완료
- [ ] 최신 펌웨어 업로드 완료

### 📦 테스트 대상
- **74HC165D** 시프트 레지스터 (8비트 병렬 입력 → 직렬 출력)
- **ESP32-C6** GPIO 인터페이스
- **버튼** 4개 (MENU, SELECT, UP, DOWN)
- **리미트 스위치** 4개 (LIMIT SW1-4)

### 🔘 입력 핀 매핑
- **A0**: SW1(Menu) 버튼
- **A1**: SW2(Select) 버튼
- **A2**: SW3(Up) 버튼
- **A3**: SW4(Down) 버튼
- **A4**: LIMIT SW1
- **A5**: LIMIT SW2
- **A6**: LIMIT SW3
- **A7**: LIMIT SW4

---

## 🔌 하드웨어 연결

### 1단계: 연결 확인

1. **PCB 연결 상태 확인**
   - ESP32-C6와 74HC165D가 올바르게 연결되어 있는지 확인
   - 버튼과 리미트 스위치가 연결되어 있는지 확인

2. **연결 다이어그램**
   ```
   ESP32-C6          74HC165D
   GPIO3 (SH_CP)  →  SH_CP (Shift Register Clock)
   GPIO15 (ST_CP) →  ST_CP (Storage Register Clock)
   GPIO10 (DATA)  →  Q7 (Serial Data Output)
   GPIO2 (PL)     →  PL (Parallel Load, Active Low)
   3.3V           →  VCC
   GND            →  GND
   ```

3. **버튼 연결 방식**
   - **풀업 방식**: 버튼을 누르지 않으면 HIGH(1), 누르면 LOW(0)
   - **공통**: 모든 버튼의 한쪽 단자는 3.3V에 연결
   - **개별**: 각 버튼의 다른 쪽 단자는 해당 A핀에 연결

---

## 📤 테스트 파일 업로드

### 1단계: 테스트 파일 업로드

1. **명령 프롬프트 열기**
   - Windows 키 + R → `cmd` 입력 → Enter

2. **프로젝트 폴더로 이동**
   ```cmd
   cd C:\Users\사용자이름\경로1\경로2\pillBox
   ```

3. **테스트 파일 업로드**
   ```cmd
   ampy -p COM3 put .\tests\test_74hc165.py
   ```

   **⚠️ 중요**: `COM3`을 실제 COM 포트 번호로 변경하세요!
---

## 🧪 테스트 실행

### 1단계: PuTTY 연결

1. **PuTTY 실행**
   - PuTTY 실행 → Load → Open

2. **연결 확인**
   - MicroPython 프롬프트(`>>>`)가 나타나면 성공

### 2단계: 테스트 실행

1. **테스트 모듈 임포트 및 실행**
   ```python
   from test_74hc165 import main
   main()
   ```

2. **테스트 메뉴 확인**
   - 다음과 같은 메뉴가 나타납니다:
   ```
   74HC165D 테스트 프로그램
   ==================================================
   1. 단일 읽기 테스트
   2. 연속 모니터링 (변경 감지 시에만 출력)
   3. 디버그 읽기 (10초)
   
   선택하세요 (1-3): 
   ```

### 3단계: 테스트 수행

1. **연속 모니터링 테스트 (권장)**
   - 메뉴에서 `2` 입력 → Enter
   - 초기 상태가 표시됩니다
   - 버튼을 누르거나 놓을 때마다 상태 변경이 감지되어 출력됩니다

2. **테스트 결과 확인**
   - 모든 버튼이 HIGH 상태로 표시되는지 확인
   - 버튼을 누를 때 해당 버튼이 LOW로 변경되는지 확인
   - 버튼을 놓을 때 다시 HIGH로 복원되는지 확인

3. **테스트 종료**
   - Ctrl+C를 눌러 테스트 종료

### 4단계: 예상 결과

**정상 동작 시 나타나는 결과:**
```
=== 연속 모니터링 시작 ===
스위치 상태가 변경될 때만 출력합니다
Ctrl+C로 중단하세요
==================================================
초기 상태:
Pin States:
  SW1(Menu): HIGH
  SW2(Select): HIGH
  SW3(Up): HIGH
  SW4(Down): HIGH
  LIMIT SW1: HIGH
  LIMIT SW2: HIGH
  LIMIT SW3: HIGH
  LIMIT SW4: HIGH

[   1]    12.3s - 변경 감지! SW1:L SW2:H SW3:H SW4:H LIM1:H LIM2:H LIM3:H LIM4:H
[   2]    15.7s - 변경 감지! SW1:H SW2:H SW3:H SW4:H LIM1:H LIM2:H LIM3:H LIM4:H
```